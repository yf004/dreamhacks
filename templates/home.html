<!DOCTYPE html>
<html>
<head>
    <link href="https://fonts.googleapis.com/css?family=Bungee&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="{{ url_for('static', filename='home.css') }}">
    <title>homev2</title>
</head>
<body>
    <div class="main-container">
        <!-- Left column - navbar -->
        <div class="navbar-column">
            <div class="logo-container">
                <div class="logo">BLOOPI</div>
            </div>
            <div class="nav-container">
                <div id="profile">
                    <span>Logged in as:</span>
                    <span id="profile-name"></span>
                </div>
                <div id='nav-home' class="nav-item">Home</div>
                <div id='nav-journal' class="nav-item">Journal</div>
                <div id='nav-chat' class="nav-item">Chatbot</div>
            </div>
			<div id="logout">Logout</div>
        </div>
        
        <!-- Middle column - calendar -->
        <div class="calendar-column">
            <div class="calendar-container">
                <div class="calendar-header">
                    <h2 id="month-year">Calendar</h2>
                    <div class="calendar-nav">
                        <button id="prev-month">&lt; Prev</button>
                        <button id="next-month">Next &gt;</button>
                    </div>
                </div>
                <table class="calendar" id="calendar-table">
                    <tr>
                        <th>Sun</th>
                        <th>Mon</th>
                        <th>Tue</th>
                        <th>Wed</th>
                        <th>Thu</th>
                        <th>Fri</th>
                        <th>Sat</th>
                    </tr>
                    <tbody id="calendar-body">
                        <!-- Calendar cells will be generated by JavaScript -->
                    </tbody>
                </table>
                <button id="current-month" class="today-button">Center to Today</button>
            </div>
            <div class="journal-entry-container">
                <button class="journal-button">Add a New Journal Entry</button>
            </div>
        </div>
        
        <!-- Right column - right -->
        <div class="right-column">
			<div class="day-month-container">
                <div class="day-month">Day Month</div>
            </div>
            <div class="emotion-container">
                <h3>How are you feeling?</h3>
                <div class="emotion-options">
                    <div class="emotion sad">üò≠</div>
                    <div class="emotion unhappy">üòü</div>
                    <div class="emotion neutral">üòê</div>
                    <div class="emotion happy">üòä</div>
                    <div class="emotion excited">üòÑ</div>
                </div>
            </div>
            <div class="chat-container">
                <button class="chat-button">Start a new Chat</button>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
        let currentDate = new Date();
        let currentMonth = currentDate.getMonth();
        let currentYear = currentDate.getFullYear();
        let selectedEmotion = null; // Track the selected emotion
        
        const monthNames = [
            "January", "February", "March", "April", "May", "June",
            "July", "August", "September", "October", "November", "December"
        ];
        
        const dayNames = [
            "Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"
        ];
        
        // Elements
        const calendarBody = document.getElementById('calendar-body');
        const calendarTable = document.querySelector('.calendar');
        const monthYearElement = document.getElementById('month-year');
        const prevMonthBtn = document.getElementById('prev-month');
        const nextMonthBtn = document.getElementById('next-month');
        const currentMonthBtn = document.getElementById('current-month');
        const dayMonthElement = document.querySelector('.day-month');
        const emotionOptions = document.querySelectorAll('.emotion');
        
        // Event listeners for navigation
        prevMonthBtn.addEventListener('click', goToPrevMonth);
        nextMonthBtn.addEventListener('click', goToNextMonth);
        currentMonthBtn.addEventListener('click', goToCurrentMonth);
        
        // Initialize the calendar and day-month display
        generateCalendar(currentMonth, currentYear);
        updateDayMonth();
        
        // Set up emotion selection
        emotionOptions.forEach(emotion => {
            emotion.addEventListener('click', function() {
                // Remove selected class from all emotions
                emotionOptions.forEach(e => e.classList.remove('selected'));
                
                // Add selected class to clicked emotion
                this.classList.add('selected');
                
                // Get the emotion type (sad, happy, etc)
                selectedEmotion = this.classList[1]; // The second class is the emotion type
                
                // Update the current date's color in the calendar
                updateCurrentDateColor(selectedEmotion);
                
                // You can also save this emotion to your database/backend here
                // For example: saveEmotionToBackend(selectedEmotion);
            });
        });
        
        // Function to update the current date's color based on selected emotion
        function updateCurrentDateColor(emotionType) {
            const currentDateElement = document.querySelector('.current-date');
            if (currentDateElement) {
                // Remove all emotion-related classes
                currentDateElement.classList.remove('emotion-sad', 'emotion-unhappy', 'emotion-neutral', 'emotion-happy', 'emotion-excited');
                
                // Add the selected emotion class
                if (emotionType) {
                    currentDateElement.classList.add(`emotion-${emotionType}`);
                }
            }
        }
        
        // Function to update the day-month display
        function updateDayMonth() {
            const today = new Date();
            const dayName = dayNames[today.getDay()];
            const monthName = monthNames[today.getMonth()];
            const dayNumber = today.getDate();
            
            // Format: "Monday May 18"
            dayMonthElement.innerHTML = `<b>${dayName}</b> ${monthName} ${dayNumber}`;
        }
        
        // Function to generate the calendar
        function generateCalendar(month, year) {
            // Clear previous calendar
            calendarBody.innerHTML = '';
            
            // Update month-year display
            monthYearElement.innerHTML = `${monthNames[month]} <b>${year}</b>`;
            
            // Get the first day of the month (0 = Sunday, 1 = Monday, etc.)
            const firstDay = new Date(year, month, 1).getDay();
            
            // Get the number of days in the month
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            // Get the number of days in the previous month
            const daysInPrevMonth = new Date(year, month, 0).getDate();
            
            // Calculate rows needed for this month
            const rowsNeeded = Math.ceil((firstDay + daysInMonth) / 7);
            
            // Adjust spacing based on number of rows needed
            if (rowsNeeded <= 5) {
                const cellSize = rowsNeeded === 4 ? '50px' : '45px';
                const spacing = rowsNeeded === 4 ? '15px 10px' : '12px 8px';
                calendarTable.style.borderSpacing = spacing;
                
                // Update date number size
                const dateNumbers = document.querySelectorAll('.date-number');
                dateNumbers.forEach(num => {
                    num.style.width = cellSize;
                    num.style.height = cellSize;
                });
            } else {
                calendarTable.style.borderSpacing = '10px 5px';
            }
            
            // Create calendar cells
            let date = 1;
            let nextMonthDate = 1;
            
            // Create rows (typically 6 rows can fit all month variations)
            for (let i = 0; i < 6; i++) {
                // Create a table row
                const row = document.createElement('tr');
                
                // Create cells for each day of the week
                for (let j = 0; j < 7; j++) {
                    const cell = document.createElement('td');
                    
                    // Fill in dates from previous month
                    if (i === 0 && j < firstDay) {
                        const prevMonthDay = daysInPrevMonth - (firstDay - j - 1);
                        const dateNumber = document.createElement('div');
                        dateNumber.className = 'date-number other-month';
                        dateNumber.textContent = prevMonthDay;
                        cell.appendChild(dateNumber);
                    } 
                    // Fill in dates for the current month
                    else if (date <= daysInMonth) {
                        const dateNumber = document.createElement('div');
                        dateNumber.className = 'date-number';
                        dateNumber.textContent = date;
                        
                        // Highlight today's date
                        if (
                            date === currentDate.getDate() && 
                            month === currentDate.getMonth() && 
                            year === currentDate.getFullYear()
                        ) {
                            dateNumber.classList.add('current-date');
                            
                            // Apply emotion color if one is selected
                            if (selectedEmotion) {
                                dateNumber.classList.add(`emotion-${selectedEmotion}`);
                            }
                        }
                        
                        cell.appendChild(dateNumber);
                        date++;
                    } 
                    // Fill in dates from next month
                    else {
                        const dateNumber = document.createElement('div');
                        dateNumber.className = 'date-number other-month';
                        dateNumber.textContent = nextMonthDate;
                        cell.appendChild(dateNumber);
                        nextMonthDate++;
                    }
                    
                    row.appendChild(cell);
                }
                
                calendarBody.appendChild(row);
                
                // Stop creating rows if we've already used all days of the month
                // and we've completed at least 4 rows (for consistency)
                if (date > daysInMonth && i >= 3) break;
            }
            
            // Set the appropriate cell size based on row count
            const cellSize = rowsNeeded <= 5 ? (rowsNeeded === 4 ? '50px' : '45px') : '40px';
            const dateNumbers = document.querySelectorAll('.date-number');
            dateNumbers.forEach(num => {
                num.style.width = cellSize;
                num.style.height = cellSize;
            });
        }
        
        // Navigation functions
        function goToPrevMonth() {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            generateCalendar(currentMonth, currentYear);
        }
        
        function goToNextMonth() {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            generateCalendar(currentMonth, currentYear);
        }
        
        function goToCurrentMonth() {
            const now = new Date();
            currentMonth = now.getMonth();
            currentYear = now.getFullYear();
            generateCalendar(currentMonth, currentYear);
        }
    });

    document.addEventListener("DOMContentLoaded", (event) => {
        fetch('/get_username')  // Replace with your API URL
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok ' + response.status);
            }
            return response.json();
        })
        .then(data => {
            document.getElementById('profile-name').textContent = data.name.toString();
        })
        .catch(error => {
            console.log(error);
        });
        setUpNavBar('home')

        document.getElementById('logout').onclick = async function(){
            window.location.href = "/logout";
        }
    });

    function setUpNavBar(curr){
        document.getElementById('nav-home').onclick = function(){
            if (curr!== 'home'){window.location.href = "/home";}
        };
        document.getElementById('nav-journal').onclick = function(){
            if (curr!== 'journal'){window.location.href = "/journal";}
        };
        document.getElementById('nav-chat').onclick = function(){
            if (curr!== 'chat'){window.location.href = "/chat";}
        };
    }
    </script>
</body>
</html>